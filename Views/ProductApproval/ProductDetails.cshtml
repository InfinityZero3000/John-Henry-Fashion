@model JohnHenryFashionWeb.Models.Product
@{
    ViewData["Title"] = "Product Details - " + Model.Name;
    Layout = "_AdminLayout";
    ViewData["CurrentSection"] = "ProductApproval";
    ViewData["Breadcrumb"] = new List<(string Text, string Url)>
    {
        ("Product Approval", "/admin/approvals/products"),
        ("Product Details", "")
    };
}

<style>
    .product-image-large {
        width: 100%;
        height: 400px;
        object-fit: cover;
        border-radius: 8px;
    }

    .product-image-thumb {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 6px;
        cursor: pointer;
        transition: border-color 0.2s;
        border: 2px solid transparent;
    }

    .product-image-thumb:hover {
        border-color: var(--admin-primary);
    }

    .info-row {
        display: grid;
        grid-template-columns: 150px 1fr;
        gap: 1rem;
        padding: 0.75rem 0;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .info-row:last-child {
        border-bottom: none;
    }

    .info-label {
        color: #6b7280;
        font-weight: 500;
    }

    .info-value {
        color: #1f2937;
    }
</style>

<div class="admin-page-header">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <a href="/admin/approvals/products" class="admin-link" style="text-decoration: none; margin-bottom: 0.5rem; display: inline-block;">
                <i data-lucide="arrow-left" style="width: 16px; height: 16px;"></i>
                Back to Products
            </a>
            <h1 class="admin-page-title">@Model.Name</h1>
            <p style="color: #6b7280; margin: 0;">Product #@Model.Id</p>
        </div>
        <div style="display: flex; gap: 0.75rem;">
            <a href="/admin/products/edit/@Model.Id" class="admin-btn admin-btn-secondary" title="Chỉnh sửa sản phẩm">
                <i data-lucide="edit"></i>
                Chỉnh sửa
            </a>
        </div>
    </div>
</div>

<div style="display: grid; grid-template-columns: 450px 1fr; gap: 1.5rem;">
    <!-- Left Column: Product Images -->
    <div>
        <div class="admin-card" style="margin-bottom: 1.5rem;">
            @if (Model.GalleryImages != null && Model.GalleryImages.Any())
            {
                <img id="mainImage" src="@Model.GalleryImages.First()" alt="@Model.Name" class="product-image-large mb-3">
                
                @if (Model.GalleryImages.Length > 1)
                {
                    <div class="d-flex gap-2 flex-wrap">
                        @foreach (var image in Model.GalleryImages)
                        {
                            <img src="@image" alt="@Model.Name" class="product-image-thumb" onclick="changeMainImage('@image')">
                        }
                    </div>
                }
            }
            else if (!string.IsNullOrEmpty(Model.FeaturedImageUrl))
            {
                <img id="mainImage" src="@Model.FeaturedImageUrl" alt="@Model.Name" class="product-image-large mb-3">
            }
            else
            {
                <div class="product-image-large bg-secondary d-flex align-items-center justify-content-center">
                    <i data-lucide="image" style="width: 80px; height: 80px; color: #9ca3af;"></i>
                </div>
            }
        </div>

        <!-- Status & Actions -->
        <div class="admin-card">
            <h5 style="margin-bottom: 1rem; font-weight: 600; display: flex; align-items: center; gap: 0.5rem;">
                <i data-lucide="activity" style="width: 18px; height: 18px;"></i>
                Product Status & Actions
            </h5>
            
            <div style="margin-bottom: 1.5rem;">
                <p style="color: #6b7280; margin-bottom: 0.5rem; font-size: 0.875rem;">Current Status</p>
                @switch (Model.Status)
                {
                    case "active":
                        <span class="admin-badge admin-badge-success">
                            <i data-lucide="check-circle" style="width: 14px; height: 14px;"></i>
                            Active
                        </span>
                        break;
                    case "inactive":
                        <span class="admin-badge admin-badge-danger">
                            <i data-lucide="x-circle" style="width: 14px; height: 14px;"></i>
                            Inactive
                        </span>
                        break;
                    case "out_of_stock":
                        <span class="admin-badge admin-badge-warning">
                            <i data-lucide="package-x" style="width: 14px; height: 14px;"></i>
                            Out of Stock
                        </span>
                        break;
                }
            </div>

            @if (Model.Status != "active" && Model.IsActive == false)
            {
                <form method="post" action="/admin/approvals/products/@Model.Id/activate">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="admin-btn admin-btn-success" style="width: 100%;">
                        <i data-lucide="check" style="width: 16px; height: 16px;"></i>
                        Activate Product
                    </button>
                </form>
            }
            
            @if (Model.Status == "active" && Model.IsActive == true)
            {
                <button type="button" class="admin-btn admin-btn-danger" style="width: 100%;" onclick="showDeactivateModal()">
                    <i data-lucide="ban" style="width: 16px; height: 16px;"></i>
                    Deactivate Product
                </button>
            }
        </div>
    </div>

    <!-- Right Column: Product Information -->
    <div>
        <!-- Basic Information -->
        <div class="admin-card" style="margin-bottom: 1.5rem;">
            <h4 style="margin-bottom: 1.5rem; font-weight: 600; display: flex; align-items: center; gap: 0.5rem;">
                <i data-lucide="info" style="width: 20px; height: 20px;"></i>
                Basic Information
            </h4>
            
            <div class="info-row">
                <span class="info-label">SKU</span>
                <span class="info-value">@Model.SKU</span>
            </div>

            <div class="info-row">
                <span class="info-label">Category</span>
                <span class="info-value">@Model.Category?.Name</span>
            </div>

            <div class="info-row">
                <span class="info-label">Brand</span>
                <span class="info-value">@Model.Brand?.Name</span>
            </div>

            <div class="info-row">
                <span class="info-label">Price</span>
                <span class="info-value" style="font-weight: 600; font-size: 1.125rem;">@Model.Price.ToString("N0") VND</span>
            </div>

            @if (Model.SalePrice.HasValue && Model.SalePrice < Model.Price)
            {
                <div class="info-row">
                    <span class="info-label">Sale Price</span>
                    <span class="info-value">
                        <s style="color: #9ca3af;">@Model.Price.ToString("N0") VND</s>
                        <span style="color: #059669; font-weight: 600; font-size: 1.125rem; margin-left: 0.5rem;">@Model.SalePrice.Value.ToString("N0") VND</span>
                        <span class="admin-badge admin-badge-danger" style="margin-left: 0.5rem;">
                            @(((Model.Price - Model.SalePrice.Value) / Model.Price * 100).ToString("0"))% OFF
                        </span>
                    </span>
                </div>
            }

            <div class="info-row">
                <span class="info-label">Stock</span>
                <span class="info-value">
                    @Model.StockQuantity units
                    @if (Model.StockQuantity < 10)
                    {
                        <span class="admin-badge admin-badge-warning" style="margin-left: 0.5rem;">Low Stock</span>
                    }
                </span>
            </div>
        </div>

        <!-- Description -->
        <div class="admin-card" style="margin-bottom: 1.5rem;">
            <h4 style="margin-bottom: 1.5rem; font-weight: 600; display: flex; align-items: center; gap: 0.5rem;">
                <i data-lucide="align-left" style="width: 20px; height: 20px;"></i>
                Description
            </h4>
            <div style="color: #6b7280; line-height: 1.8;">
                @Html.Raw(Model.Description)
            </div>
        </div>

        <!-- Statistics -->
        <div class="admin-card">
            <h4 style="margin-bottom: 1.5rem; font-weight: 600; display: flex; align-items: center; gap: 0.5rem;">
                <i data-lucide="bar-chart-2" style="width: 20px; height: 20px;"></i>
                Statistics
            </h4>

            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                <div style="text-align: center; padding: 1.5rem; background: #f9fafb; border-radius: 8px;">
                    <i data-lucide="eye" style="width: 32px; height: 32px; color: #3b82f6; margin-bottom: 0.75rem;"></i>
                    <h4 style="margin: 0 0 0.25rem 0; color: #1f2937;">@Model.ViewCount</h4>
                    <small style="color: #6b7280;">Views</small>
                </div>
                <div style="text-align: center; padding: 1.5rem; background: #f9fafb; border-radius: 8px;">
                    <i data-lucide="package" style="width: 32px; height: 32px; color: #10b981; margin-bottom: 0.75rem;"></i>
                    <h4 style="margin: 0 0 0.25rem 0; color: #1f2937;">@(Model.StockQuantity > 0 ? "In Stock" : "Out")</h4>
                    <small style="color: #6b7280;">Stock Status</small>
                </div>
                <div style="text-align: center; padding: 1.5rem; background: #f9fafb; border-radius: 8px;">
                    <i data-lucide="star" style="width: 32px; height: 32px; color: #f59e0b; margin-bottom: 0.75rem;"></i>
                    <h4 style="margin: 0 0 0.25rem 0; color: #1f2937;">@(Model.Rating.HasValue ? Model.Rating.Value.ToString("0.0") : "N/A")</h4>
                    <small style="color: #6b7280;">Rating</small>
                </div>
                <div style="text-align: center; padding: 1.5rem; background: #f9fafb; border-radius: 8px;">
                    <i data-lucide="message-square" style="width: 32px; height: 32px; color: #6366f1; margin-bottom: 0.75rem;"></i>
                    <h4 style="margin: 0 0 0.25rem 0; color: #1f2937;">@Model.ReviewCount</h4>
                    <small style="color: #6b7280;">Reviews</small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Deactivate Modal -->
<div class="admin-modal" id="deactivateModal" style="display: none;">
    <div class="admin-modal-content">
        <div class="admin-modal-header">
            <h3 class="admin-modal-title">Deactivate Product</h3>
            <button type="button" class="admin-modal-close" onclick="closeDeactivateModal()">
                <i data-lucide="x" style="width: 20px; height: 20px;"></i>
            </button>
        </div>
        <form method="post" action="/admin/approvals/products/@Model.Id/deactivate">
            @Html.AntiForgeryToken()
            <div class="admin-modal-body">
                <div class="admin-alert admin-alert-warning" style="margin-bottom: 1rem;">
                    <i data-lucide="alert-triangle" style="width: 16px; height: 16px;"></i>
                    <span>Are you sure you want to deactivate <strong>@Model.Name</strong>?</span>
                </div>
                <div class="admin-form-group">
                    <label class="admin-form-label">Reason (Optional)</label>
                    <textarea name="reason" class="admin-form-control" rows="3" placeholder="Enter reason for deactivating this product..."></textarea>
                    <small style="color: #6b7280; font-size: 0.875rem;">This reason will be logged for administrative purposes.</small>
                </div>
            </div>
            <div class="admin-modal-footer">
                <button type="button" class="admin-btn admin-btn-secondary" onclick="closeDeactivateModal()">Cancel</button>
                <button type="submit" class="admin-btn admin-btn-danger">
                    <i data-lucide="ban" style="width: 16px; height: 16px;"></i>
                    Deactivate Product
                </button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        function changeMainImage(imageUrl) {
            document.getElementById('mainImage').src = imageUrl;
        }

        function showDeactivateModal() {
            document.getElementById('deactivateModal').style.display = 'flex';
            setTimeout(() => { lucide.createIcons(); }, 10);
        }

        function closeDeactivateModal() {
            document.getElementById('deactivateModal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const deactivateModal = document.getElementById('deactivateModal');
            if (event.target === deactivateModal) {
                closeDeactivateModal();
            }
        }
    </script>
}
