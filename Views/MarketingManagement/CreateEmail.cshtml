@model JohnHenryFashionWeb.Models.EmailCampaign
@{
    ViewData["Title"] = "T·∫°o Email Campaign m·ªõi";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    ViewData["Breadcrumb"] = "<li class=\"breadcrumb-item\"><a href=\"/admin/marketing\">Marketing</a></li><li class=\"breadcrumb-item\"><a href=\"/admin/marketing/email\">Email Campaigns</a></li><li class=\"breadcrumb-item active\">T·∫°o m·ªõi</li>";
}

<div class="admin-content">
    <div class="admin-page-header">
        <h1 class="admin-page-title">
            <i data-lucide="mail-plus"></i>
            T·∫°o Email Campaign m·ªõi
        </h1>
    </div>

    <div class="admin-card">
        <div class="admin-card-body">
            <form method="post" action="/admin/marketing/email/create">
                @Html.AntiForgeryToken()
                
                <div class="admin-form-section">
                    <h3 class="admin-form-section-title"><i data-lucide="info"></i> Th√¥ng tin c∆° b·∫£n</h3>
                    <div class="mb-3">
                        <label for="Name" class="form-label">T√™n Campaign <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="Name" name="Name" required />
                    </div>
                    <div class="mb-3">
                        <label for="Subject" class="form-label">Subject Email <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="Subject" name="Subject" required />
                    </div>
                </div>

                <div class="admin-form-section">
                    <h3 class="admin-form-section-title"><i data-lucide="file-text"></i> N·ªôi dung</h3>
                    
                    <!-- Email Templates -->
                    <div class="mb-4">
                        <label class="form-label fw-bold">Ch·ªçn m·∫´u email c√≥ s·∫µn</label>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <div class="template-card" data-template="promotional" style="cursor: pointer; border: 2px solid var(--admin-border); border-radius: 8px; padding: 1rem; transition: all 0.3s;">
                                    <img src="https://raw.githubusercontent.com/InfinityZero3000/Image-CDN/refs/heads/main/banner_8fa38793.jpg" alt="Promotional" style="width: 100%; height: 120px; object-fit: cover; border-radius: 4px; margin-bottom: 0.5rem;">
                                    <h5 style="margin: 0.5rem 0 0.25rem 0; font-size: 0.95rem;">üéâ Khuy·∫øn m√£i</h5>
                                    <p style="margin: 0; font-size: 0.8rem; color: var(--admin-text-light);">Email gi·ªõi thi·ªáu s·∫£n ph·∫©m v√† khuy·∫øn m√£i</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="template-card" data-template="newsletter" style="cursor: pointer; border: 2px solid var(--admin-border); border-radius: 8px; padding: 1rem; transition: all 0.3s;">
                                    <div style="width: 100%; height: 120px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 4px; margin-bottom: 0.5rem; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;">üì∞</div>
                                    <h5 style="margin: 0.5rem 0 0.25rem 0; font-size: 0.95rem;">üì∞ Newsletter</h5>
                                    <p style="margin: 0; font-size: 0.8rem; color: var(--admin-text-light);">Tin t·ª©c v√† c·∫≠p nh·∫≠t m·ªõi nh·∫•t</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="template-card" data-template="announcement" style="cursor: pointer; border: 2px solid var(--admin-border); border-radius: 8px; padding: 1rem; transition: all 0.3s;">
                                    <div style="width: 100%; height: 120px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 4px; margin-bottom: 0.5rem; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;">üì¢</div>
                                    <h5 style="margin: 0.5rem 0 0.25rem 0; font-size: 0.95rem;">üì¢ Th√¥ng b√°o</h5>
                                    <p style="margin: 0; font-size: 0.8rem; color: var(--admin-text-light);">Th√¥ng b√°o quan tr·ªçng cho kh√°ch h√†ng</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Editor Tabs -->
                    <ul class="nav nav-tabs mb-3" id="editorTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="visual-tab" data-bs-toggle="tab" data-bs-target="#visual-editor" type="button">
                                <i data-lucide="edit" style="width: 16px; height: 16px;"></i> So·∫°n th·∫£o
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="preview-tab" data-bs-toggle="tab" data-bs-target="#preview" type="button">
                                <i data-lucide="eye" style="width: 16px; height: 16px;"></i> Xem tr∆∞·ªõc
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="html-tab" data-bs-toggle="tab" data-bs-target="#html-editor" type="button">
                                <i data-lucide="code" style="width: 16px; height: 16px;"></i> HTML
                            </button>
                        </li>
                    </ul>

                    <div class="tab-content" id="editorTabsContent">
                        <!-- Visual Editor -->
                        <div class="tab-pane fade show active" id="visual-editor">
                            <div class="mb-3">
                                <textarea class="form-control" id="HtmlContent" name="HtmlContent" rows="10" required></textarea>
                            </div>
                        </div>

                        <!-- Preview -->
                        <div class="tab-pane fade" id="preview">
                            <div id="email-preview" style="border: 1px solid var(--admin-border); border-radius: 8px; padding: 2rem; background: #f5f5f5; min-height: 400px;">
                                <div style="max-width: 600px; margin: 0 auto; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                    <p style="padding: 2rem; color: #666; text-align: center;">Ch·ªçn m·∫´u email ho·∫∑c so·∫°n n·ªôi dung ƒë·ªÉ xem tr∆∞·ªõc</p>
                                </div>
                            </div>
                        </div>

                        <!-- HTML Code -->
                        <div class="tab-pane fade" id="html-editor">
                            <textarea id="html-code" class="form-control" rows="15" style="font-family: 'Courier New', monospace; font-size: 0.875rem;"></textarea>
                        </div>
                    </div>

                    <div class="mb-3 mt-3">
                        <label for="PlainTextContent" class="form-label">Plain Text (D·ª± ph√≤ng)</label>
                        <textarea class="form-control" id="PlainTextContent" name="PlainTextContent" rows="5"></textarea>
                    </div>
                </div>

                <div class="admin-form-section">
                    <h3 class="admin-form-section-title"><i data-lucide="users"></i> ƒê·ªëi t∆∞·ª£ng & Tr·∫°ng th√°i</h3>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="TargetAudience" class="form-label">ƒê·ªëi t∆∞·ª£ng</label>
                            <select class="form-select" id="TargetAudience" name="TargetAudience">
                                <option value="all">T·∫•t c·∫£</option>
                                <option value="customers">Kh√°ch h√†ng</option>
                                <option value="sellers">Ng∆∞·ªùi b√°n</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="Status" class="form-label">Tr·∫°ng th√°i</label>
                            <select class="form-select" id="Status" name="Status">
                                <option value="draft">Nh√°p</option>
                                <option value="scheduled">L√™n l·ªãch</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="ScheduledAt" class="form-label">Th·ªùi gian g·ª≠i</label>
                            <input type="datetime-local" class="form-control" id="ScheduledAt" name="ScheduledAt" />
                        </div>
                    </div>
                </div>

            <div class="mb-3">
                <label class="form-label">Target Segment Criteria (JSON)</label>
                <textarea class="form-control" name="TargetSegmentCriteria" rows="3">@Model.TargetSegmentCriteria</textarea>
            </div>

                <div class="admin-form-actions" style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--admin-border-color);">
                    <button type="submit" class="admin-btn admin-btn-primary admin-btn-lg">
                        <i data-lucide="send"></i> T·∫°o Campaign
                    </button>
                    <a href="/admin/marketing/email" class="admin-btn admin-btn-secondary admin-btn-lg">
                        <i data-lucide="x"></i> H·ªßy
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js"></script>
    <script>
        lucide.createIcons();

        // Email Templates v·ªõi CDN images
        const templates = {
            promotional: `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khuy·∫øn m√£i ƒë·∫∑c bi·ªát</title>
</head>
<body style="margin: 0; padding: 0; font-family: Arial, sans-serif; background-color: #f4f4f4;">
    <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
        <tr>
            <td style="padding: 20px 0;">
                <table role="presentation" style="max-width: 600px; margin: 0 auto; background-color: #ffffff;" width="100%" cellspacing="0" cellpadding="0" border="0">
                    <!-- Header -->
                    <tr>
                        <td style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 40px 20px; text-align: center;">
                            <h1 style="color: #ffffff; margin: 0; font-size: 32px;">üéâ KHUY·∫æN M√ÉI ƒê·∫∂C BI·ªÜT</h1>
                            <p style="color: #ffffff; margin: 10px 0 0 0; font-size: 18px;">Gi·∫£m gi√° l√™n ƒë·∫øn 50%</p>
                        </td>
                    </tr>
                    
                    <!-- Hero Image -->
                    <tr>
                        <td style="padding: 0;">
                            <img src="https://raw.githubusercontent.com/InfinityZero3000/Image-CDN/refs/heads/main/banner_8fa38793.jpg" alt="Banner" style="width: 100%; height: auto; display: block;">
                        </td>
                    </tr>
                    
                    <!-- Content -->
                    <tr>
                        <td style="padding: 40px 30px;">
                            <h2 style="color: #333333; margin: 0 0 20px 0;">Xin ch√†o!</h2>
                            <p style="color: #666666; line-height: 1.6; margin: 0 0 20px 0;">
                                Ch√∫ng t√¥i r·∫•t vui m·ª´ng th√¥ng b√°o ch∆∞∆°ng tr√¨nh khuy·∫øn m√£i ƒë·∫∑c bi·ªát d√†nh ri√™ng cho b·∫°n. 
                                H√†ng ng√†n s·∫£n ph·∫©m th·ªùi trang cao c·∫•p ƒëang ƒë∆∞·ª£c gi·∫£m gi√° l√™n ƒë·∫øn 50%!
                            </p>
                            <p style="color: #666666; line-height: 1.6; margin: 0 0 30px 0;">
                                ‚è∞ Nhanh tay, ch∆∞∆°ng tr√¨nh ch·ªâ di·ªÖn ra trong th·ªùi gian c√≥ h·∫°n!
                            </p>
                            
                            <!-- CTA Button -->
                            <table role="presentation" cellspacing="0" cellpadding="0" border="0" style="margin: 0 auto;">
                                <tr>
                                    <td style="border-radius: 50px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                        <a href="#" style="display: inline-block; padding: 16px 48px; color: #ffffff; text-decoration: none; font-weight: bold; font-size: 16px;">
                                            MUA NGAY
                                        </a>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    
                    <!-- Features -->
                    <tr>
                        <td style="padding: 0 30px 40px 30px;">
                            <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
                                <tr>
                                    <td width="33%" style="padding: 10px; text-align: center;">
                                        <div style="font-size: 32px;">üöö</div>
                                        <p style="margin: 10px 0 0 0; color: #666666; font-size: 14px;">Mi·ªÖn ph√≠ v·∫≠n chuy·ªÉn</p>
                                    </td>
                                    <td width="33%" style="padding: 10px; text-align: center;">
                                        <div style="font-size: 32px;">üíØ</div>
                                        <p style="margin: 10px 0 0 0; color: #666666; font-size: 14px;">ƒê·∫£m b·∫£o ch·∫•t l∆∞·ª£ng</p>
                                    </td>
                                    <td width="33%" style="padding: 10px; text-align: center;">
                                        <div style="font-size: 32px;">üîÑ</div>
                                        <p style="margin: 10px 0 0 0; color: #666666; font-size: 14px;">ƒê·ªïi tr·∫£ d·ªÖ d√†ng</p>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    
                    <!-- Footer -->
                    <tr>
                        <td style="background-color: #f8f8f8; padding: 30px; text-align: center;">
                            <p style="margin: 0 0 10px 0; color: #999999; font-size: 14px;">John Henry Fashion</p>
                            <p style="margin: 0 0 10px 0; color: #999999; font-size: 12px;">
                                B·∫°n nh·∫≠n ƒë∆∞·ª£c email n√†y v√¨ ƒë√£ ƒëƒÉng k√Ω nh·∫≠n th√¥ng tin t·ª´ ch√∫ng t√¥i
                            </p>
                            <p style="margin: 0; color: #999999; font-size: 12px;">
                                <a href="#" style="color: #667eea; text-decoration: none;">H·ªßy ƒëƒÉng k√Ω</a>
                            </p>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</body>
</html>`,
            
            newsletter: `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newsletter</title>
</head>
<body style="margin: 0; padding: 0; font-family: Arial, sans-serif; background-color: #f4f4f4;">
    <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
        <tr>
            <td style="padding: 20px 0;">
                <table role="presentation" style="max-width: 600px; margin: 0 auto; background-color: #ffffff;" width="100%" cellspacing="0" cellpadding="0" border="0">
                    <!-- Header -->
                    <tr>
                        <td style="padding: 30px; background-color: #2c3e50;">
                            <h1 style="color: #ffffff; margin: 0; font-size: 28px;">üì∞ John Henry Newsletter</h1>
                            <p style="color: #ecf0f1; margin: 10px 0 0 0;">Tin t·ª©c & xu h∆∞·ªõng th·ªùi trang</p>
                        </td>
                    </tr>
                    
                    <!-- Main Content -->
                    <tr>
                        <td style="padding: 40px 30px;">
                            <h2 style="color: #2c3e50; margin: 0 0 20px 0;">Ch√†o m·ª´ng th√°ng m·ªõi! üéä</h2>
                            <p style="color: #666666; line-height: 1.8; margin: 0 0 25px 0;">
                                Th√°ng n√†y ch√∫ng t√¥i mang ƒë·∫øn cho b·∫°n nh·ªØng xu h∆∞·ªõng th·ªùi trang m·ªõi nh·∫•t, 
                                c√°c b·ªô s∆∞u t·∫≠p ƒë·ªôc quy·ªÅn v√† nhi·ªÅu ∆∞u ƒë√£i h·∫•p d·∫´n.
                            </p>
                            
                            <!-- Article 1 -->
                            <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0" style="margin-bottom: 30px;">
                                <tr>
                                    <td width="40%" style="padding-right: 20px;">
                                        <img src="https://raw.githubusercontent.com/InfinityZero3000/Image-CDN/refs/heads/main/banner_8fa38793.jpg" alt="Trend" style="width: 100%; height: auto; border-radius: 8px;">
                                    </td>
                                    <td width="60%">
                                        <h3 style="color: #2c3e50; margin: 0 0 10px 0; font-size: 18px;">Xu h∆∞·ªõng Thu ƒê√¥ng 2025</h3>
                                        <p style="color: #666666; line-height: 1.6; margin: 0 0 10px 0; font-size: 14px;">
                                            Kh√°m ph√° nh·ªØng gam m√†u ·∫•m √°p v√† phong c√°ch ƒë·ªôc ƒë√°o cho m√πa l·∫°nh s·∫Øp t·ªõi.
                                        </p>
                                        <a href="#" style="color: #3498db; text-decoration: none; font-weight: bold; font-size: 14px;">ƒê·ªçc th√™m ‚Üí</a>
                                    </td>
                                </tr>
                            </table>
                            
                            <!-- Article 2 -->
                            <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0" style="margin-bottom: 30px;">
                                <tr>
                                    <td width="40%" style="padding-right: 20px;">
                                        <div style="width: 100%; height: 120px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                            <span style="font-size: 48px;">üëî</span>
                                        </div>
                                    </td>
                                    <td width="60%">
                                        <h3 style="color: #2c3e50; margin: 0 0 10px 0; font-size: 18px;">B·ªô s∆∞u t·∫≠p m·ªõi</h3>
                                        <p style="color: #666666; line-height: 1.6; margin: 0 0 10px 0; font-size: 14px;">
                                            Nh·ªØng thi·∫øt k·∫ø ƒë·ªôc quy·ªÅn v·ª´a ƒë∆∞·ª£c ra m·∫Øt trong tu·∫ßn n√†y.
                                        </p>
                                        <a href="#" style="color: #3498db; text-decoration: none; font-weight: bold; font-size: 14px;">Xem ngay ‚Üí</a>
                                    </td>
                                </tr>
                            </table>
                            
                            <!-- Tips Section -->
                            <div style="background-color: #ecf0f1; border-left: 4px solid #3498db; padding: 20px; border-radius: 4px; margin-top: 30px;">
                                <h4 style="color: #2c3e50; margin: 0 0 10px 0;">üí° Tips ph·ªëi ƒë·ªì</h4>
                                <p style="color: #666666; line-height: 1.6; margin: 0; font-size: 14px;">
                                    H·ªçc c√°ch k·∫øt h·ª£p trang ph·ª•c c√¥ng s·ªü v·ªõi ph·ª• ki·ªán ƒë·ªÉ t·∫°o phong c√°ch ri√™ng bi·ªát v√† chuy√™n nghi·ªáp.
                                </p>
                            </div>
                        </td>
                    </tr>
                    
                    <!-- Footer -->
                    <tr>
                        <td style="background-color: #2c3e50; padding: 30px; text-align: center;">
                            <p style="margin: 0 0 15px 0; color: #ecf0f1; font-size: 14px;">Theo d√µi ch√∫ng t√¥i</p>
                            <table role="presentation" cellspacing="0" cellpadding="0" border="0" style="margin: 0 auto 15px auto;">
                                <tr>
                                    <td style="padding: 0 10px;">
                                        <a href="#" style="color: #ecf0f1; font-size: 24px; text-decoration: none;">üìò</a>
                                    </td>
                                    <td style="padding: 0 10px;">
                                        <a href="#" style="color: #ecf0f1; font-size: 24px; text-decoration: none;">üì∑</a>
                                    </td>
                                    <td style="padding: 0 10px;">
                                        <a href="#" style="color: #ecf0f1; font-size: 24px; text-decoration: none;">üê¶</a>
                                    </td>
                                </tr>
                            </table>
                            <p style="margin: 0; color: #95a5a6; font-size: 12px;">
                                ¬© 2025 John Henry Fashion. All rights reserved.
                            </p>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</body>
</html>`,
            
            announcement: `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th√¥ng b√°o quan tr·ªçng</title>
</head>
<body style="margin: 0; padding: 0; font-family: Arial, sans-serif; background-color: #f4f4f4;">
    <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
        <tr>
            <td style="padding: 20px 0;">
                <table role="presentation" style="max-width: 600px; margin: 0 auto; background-color: #ffffff; border-top: 5px solid #e74c3c;" width="100%" cellspacing="0" cellpadding="0" border="0">
                    <!-- Header -->
                    <tr>
                        <td style="padding: 40px 30px; text-align: center; background-color: #fef5e7;">
                            <div style="font-size: 48px; margin-bottom: 10px;">üì¢</div>
                            <h1 style="color: #e74c3c; margin: 0; font-size: 28px;">TH√îNG B√ÅO QUAN TR·ªåNG</h1>
                        </td>
                    </tr>
                    
                    <!-- Content -->
                    <tr>
                        <td style="padding: 40px 30px;">
                            <p style="color: #666666; line-height: 1.8; margin: 0 0 20px 0; font-size: 16px;">
                                K√≠nh g·ª≠i Qu√Ω kh√°ch h√†ng,
                            </p>
                            <p style="color: #666666; line-height: 1.8; margin: 0 0 20px 0; font-size: 16px;">
                                Ch√∫ng t√¥i xin th√¥ng b√°o v·ªÅ [N·ªòI DUNG TH√îNG B√ÅO]. ƒêi·ªÅu n√†y c√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn 
                                tr·∫£i nghi·ªám mua s·∫Øm c·ªßa b·∫°n trong th·ªùi gian t·ªõi.
                            </p>
                            
                            <!-- Important Box -->
                            <div style="background: linear-gradient(135deg, #fff5f5 0%, #ffe5e5 100%); border-left: 4px solid #e74c3c; padding: 20px; border-radius: 8px; margin: 30px 0;">
                                <h3 style="color: #e74c3c; margin: 0 0 15px 0; font-size: 18px;">‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng</h3>
                                <ul style="color: #666666; line-height: 1.8; margin: 0; padding-left: 20px;">
                                    <li>ƒêi·ªÉm quan tr·ªçng s·ªë 1</li>
                                    <li>ƒêi·ªÉm quan tr·ªçng s·ªë 2</li>
                                    <li>ƒêi·ªÉm quan tr·ªçng s·ªë 3</li>
                                </ul>
                            </div>
                            
                            <p style="color: #666666; line-height: 1.8; margin: 20px 0 30px 0; font-size: 16px;">
                                N·∫øu b·∫°n c√≥ b·∫•t k·ª≥ th·∫Øc m·∫Øc n√†o, vui l√≤ng li√™n h·ªá v·ªõi ch√∫ng t√¥i qua:
                            </p>
                            
                            <!-- Contact Info -->
                            <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0" style="margin-bottom: 30px;">
                                <tr>
                                    <td style="padding: 15px; background-color: #f8f9fa; border-radius: 8px;">
                                        <p style="margin: 0 0 10px 0; color: #2c3e50;"><strong>üìß Email:</strong> support@johnhenry.com</p>
                                        <p style="margin: 0 0 10px 0; color: #2c3e50;"><strong>üìû Hotline:</strong> 1900 xxxx</p>
                                        <p style="margin: 0; color: #2c3e50;"><strong>‚è∞ Gi·ªù l√†m vi·ªác:</strong> 8:00 - 22:00 h√†ng ng√†y</p>
                                    </td>
                                </tr>
                            </table>
                            
                            <p style="color: #666666; line-height: 1.8; margin: 0; font-size: 16px;">
                                Tr√¢n tr·ªçng,<br>
                                <strong>ƒê·ªôi ng≈© John Henry Fashion</strong>
                            </p>
                        </td>
                    </tr>
                    
                    <!-- Footer -->
                    <tr>
                        <td style="background-color: #f8f8f8; padding: 30px; text-align: center; border-top: 1px solid #e0e0e0;">
                            <p style="margin: 0 0 10px 0; color: #999999; font-size: 14px;">John Henry Fashion</p>
                            <p style="margin: 0; color: #999999; font-size: 12px;">
                                Email n√†y ƒë∆∞·ª£c g·ª≠i t·ª± ƒë·ªông, vui l√≤ng kh√¥ng ph·∫£n h·ªìi
                            </p>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</body>
</html>`
        };

        // Initialize TinyMCE
        tinymce.init({
            selector: '#HtmlContent',
            height: 500,
            plugins: 'code link image lists table visualblocks',
            toolbar: 'undo redo | formatselect | bold italic | alignleft aligncenter alignright | bullist numlist | link image | code',
            setup: function(editor) {
                editor.on('change', function() {
                    updatePreview();
                    updateHtmlCode();
                });
            }
        });

        // Template selection
        document.querySelectorAll('.template-card').forEach(card => {
            card.addEventListener('click', function() {
                const templateType = this.dataset.template;
                const templateHtml = templates[templateType];
                
                // Highlight selected template
                document.querySelectorAll('.template-card').forEach(c => {
                    c.style.borderColor = 'var(--admin-border)';
                    c.style.boxShadow = 'none';
                });
                this.style.borderColor = '#667eea';
                this.style.boxShadow = '0 4px 12px rgba(102, 126, 234, 0.3)';
                
                // Set content
                if (tinymce.get('HtmlContent')) {
                    tinymce.get('HtmlContent').setContent(templateHtml);
                } else {
                    document.getElementById('HtmlContent').value = templateHtml;
                }
                
                updatePreview();
                updateHtmlCode();
                
                // Show success message
                const toast = document.createElement('div');
                toast.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #10b981; color: white; padding: 15px 25px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 9999; animation: slideIn 0.3s ease;';
                toast.innerHTML = '<i data-lucide="check-circle" style="width: 16px; height: 16px;"></i> ƒê√£ √°p d·ª•ng m·∫´u email';
                document.body.appendChild(toast);
                lucide.createIcons();
                setTimeout(() => toast.remove(), 3000);
            });
        });

        // Update preview
        function updatePreview() {
            const content = tinymce.get('HtmlContent') ? tinymce.get('HtmlContent').getContent() : document.getElementById('HtmlContent').value;
            document.getElementById('email-preview').innerHTML = content;
        }

        // Update HTML code view
        function updateHtmlCode() {
            const content = tinymce.get('HtmlContent') ? tinymce.get('HtmlContent').getContent() : document.getElementById('HtmlContent').value;
            document.getElementById('html-code').value = content;
        }

        // Sync HTML code back to editor
        document.getElementById('html-code').addEventListener('input', function() {
            if (tinymce.get('HtmlContent')) {
                tinymce.get('HtmlContent').setContent(this.value);
            } else {
                document.getElementById('HtmlContent').value = this.value;
            }
            updatePreview();
        });

        // Auto-generate plain text from HTML
        document.getElementById('HtmlContent').addEventListener('change', function() {
            const html = this.value;
            const plainText = html.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim();
            document.getElementById('PlainTextContent').value = plainText.substring(0, 500);
        });

        // Template card hover effect
        document.querySelectorAll('.template-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                if (this.style.borderColor !== 'rgb(102, 126, 234)') {
                    this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
                    this.style.transform = 'translateY(-2px)';
                }
            });
            card.addEventListener('mouseleave', function() {
                if (this.style.borderColor !== 'rgb(102, 126, 234)') {
                    this.style.boxShadow = 'none';
                    this.style.transform = 'translateY(0)';
                }
            });
        });
    </script>
    <style>
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .nav-tabs .nav-link {
            color: #666;
            border: none;
            border-bottom: 2px solid transparent;
        }
        .nav-tabs .nav-link.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: none;
        }
        .nav-tabs .nav-link:hover {
            border-color: transparent;
            border-bottom-color: #667eea;
        }
    </style>
}
