@model JohnHenryFashionWeb.ViewModels.SellerSettingsViewModel
@{
    ViewData["Title"] = "Cài đặt";
    Layout = "~/Views/Shared/_SellerLayout.cshtml";
}

<div class="admin-content">
    <!-- Page Header -->
    <div class="admin-page-header">
        <div class="admin-flex-between">
            <h1 class="admin-page-title">
                <i data-lucide="settings"></i>
                Cài đặt
            </h1>
        </div>
    </div>

    <!-- Alert Messages -->
    @if (TempData["Success"] != null)
    {
        <div class="admin-alert admin-alert-success">
            <i data-lucide="check-circle"></i>
            <span>@TempData["Success"]</span>
        </div>
    }

    <form asp-action="Settings" method="post">
        <div class="row">
            <!-- Main Settings -->
            <div class="col-lg-8">
                <!-- Business Settings -->
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h2 class="admin-card-title">
                            <i data-lucide="store"></i>
                            Cài đặt Kinh doanh
                        </h2>
                    </div>
                    <div class="admin-card-body">
                        <div class="mb-4">
                            <label class="admin-form-label">Trạng thái cửa hàng</label>
                            <div class="admin-form-switch">
                                <input asp-for="IsStoreActive" type="checkbox" id="storeActiveSwitch">
                                <label for="storeActiveSwitch">Kích hoạt cửa hàng</label>
                            </div>
                            <small class="text-muted">
                                Khi tắt, khách hàng sẽ không thể xem sản phẩm của bạn
                            </small>
                        </div>

                        <div class="mb-4">
                            <label asp-for="StoreDescription" class="admin-form-label">
                                Mô tả cửa hàng
                            </label>
                            <textarea asp-for="StoreDescription" class="admin-form-input" rows="4" 
                                      placeholder="Mô tả ngắn gọn về cửa hàng và sản phẩm của bạn"></textarea>
                            <span asp-validation-for="StoreDescription" class="text-danger"></span>
                            <small class="text-muted">Tối đa 500 ký tự</small>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="BusinessHoursStart" class="admin-form-label">
                                        Giờ mở cửa
                                    </label>
                                    <input asp-for="BusinessHoursStart" type="time" class="admin-form-input" />
                                    <span asp-validation-for="BusinessHoursStart" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="BusinessHoursEnd" class="admin-form-label">
                                        Giờ đóng cửa
                                    </label>
                                    <input asp-for="BusinessHoursEnd" type="time" class="admin-form-input" />
                                    <span asp-validation-for="BusinessHoursEnd" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="admin-form-label">Ngày nghỉ trong tuần</label>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="admin-checkbox-group">
                                        <label>
                                            <input asp-for="ClosedOnMonday" type="checkbox">
                                            <span>Thứ Hai</span>
                                        </label>
                                        <label>
                                            <input asp-for="ClosedOnTuesday" type="checkbox">
                                            <span>Thứ Ba</span>
                                        </label>
                                        <label>
                                            <input asp-for="ClosedOnWednesday" type="checkbox">
                                            <span>Thứ Tư</span>
                                        </label>
                                        <label>
                                            <input asp-for="ClosedOnThursday" type="checkbox">
                                            <span>Thứ Năm</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="admin-checkbox-group">
                                        <label>
                                            <input asp-for="ClosedOnFriday" type="checkbox">
                                            <span>Thứ Sáu</span>
                                        </label>
                                        <label>
                                            <input asp-for="ClosedOnSaturday" type="checkbox">
                                            <span>Thứ Bảy</span>
                                        </label>
                                        <label>
                                            <input asp-for="ClosedOnSunday" type="checkbox">
                                            <span>Chủ Nhật</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notification Settings -->
                <div class="admin-card" style="margin-top: 1.5rem;">
                    <div class="admin-card-header">
                        <h2 class="admin-card-title">
                            <i data-lucide="bell"></i>
                            Cài đặt Thông báo
                        </h2>
                    </div>
                    <div class="admin-card-body">
                        <div class="mb-3">
                            <label class="admin-form-label">Thông báo Email</label>
                            <div class="admin-checkbox-group">
                                <label>
                                    <input asp-for="EmailNotifications.NewOrders" type="checkbox">
                                    <span>Đơn hàng mới</span>
                                </label>
                                <label>
                                    <input asp-for="EmailNotifications.LowStock" type="checkbox">
                                    <span>Hàng sắp hết</span>
                                </label>
                                <label>
                                    <input asp-for="EmailNotifications.ProductReviews" type="checkbox">
                                    <span>Đánh giá sản phẩm mới</span>
                                </label>
                                <label>
                                    <input asp-for="EmailNotifications.SystemUpdates" type="checkbox">
                                    <span>Cập nhật hệ thống</span>
                                </label>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label asp-for="ReportFrequency" class="admin-form-label">Tần suất báo cáo</label>
                            <select asp-for="ReportFrequency" class="admin-form-select">
                                <option value="Daily">Hằng ngày</option>
                                <option value="Weekly">Hằng tuần</option>
                                <option value="Monthly">Hằng tháng</option>
                                <option value="Never">Không nhận</option>
                            </select>
                            <small class="text-muted">
                                Bạn sẽ nhận báo cáo doanh số qua email theo tần suất này
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Inventory Settings -->
                <div class="admin-card" style="margin-top: 1.5rem;">
                    <div class="admin-card-header">
                        <h2 class="admin-card-title">
                            <i data-lucide="package"></i>
                            Cài đặt Kho hàng
                        </h2>
                    </div>
                    <div class="admin-card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="LowStockThreshold" class="admin-form-label">
                                        Ngưỡng cảnh báo hết hàng
                                    </label>
                                    <input asp-for="LowStockThreshold" type="number" class="admin-form-input" min="0" />
                                    <span asp-validation-for="LowStockThreshold" class="text-danger"></span>
                                    <small class="text-muted">
                                        Cảnh báo khi số lượng sản phẩm dưới ngưỡng này
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="admin-form-label">Ẩn sản phẩm hết hàng</label>
                                    <div class="admin-form-switch">
                                        <input asp-for="AutoHideOutOfStock" type="checkbox" id="autoHideSwitch">
                                        <label for="autoHideSwitch">Tự động ẩn</label>
                                    </div>
                                    <small class="text-muted">
                                        Tự động ẩn sản phẩm khi hết hàng
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="admin-card" style="margin-top: 1.5rem;">
                    <div class="admin-card-body">
                        <div style="display: flex; gap: 0.75rem;">
                            <button type="submit" class="admin-btn admin-btn-primary">
                                <i data-lucide="save"></i>
                                Lưu cài đặt
                            </button>
                            <button type="button" class="admin-btn admin-btn-secondary" onclick="resetForm()">
                                <i data-lucide="rotate-ccw"></i>
                                Khôi phục
                            </button>
                            <a href="@Url.Action("Dashboard", "Seller")" class="admin-btn admin-btn-outline">
                                <i data-lucide="x"></i>
                                Hủy
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- Quick Stats -->
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h2 class="admin-card-title">
                            <i data-lucide="trending-up"></i>
                            Thống kê nhanh
                        </h2>
                    </div>
                    <div class="admin-card-body">
                        <div class="row text-center">
                            <div class="col-6" style="border-right: 1px solid var(--admin-border);">
                                <h4 style="margin-bottom: 0.25rem; color: var(--admin-primary);">@Model.TotalProducts</h4>
                                <small class="text-muted">Sản phẩm</small>
                            </div>
                            <div class="col-6">
                                <h4 style="margin-bottom: 0.25rem; color: var(--admin-success);">@Model.TotalOrders</h4>
                                <small class="text-muted">Đơn hàng</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Store Status -->
                <div class="admin-card" style="margin-top: 1.5rem;">
                    <div class="admin-card-header">
                        <h2 class="admin-card-title">
                            <i data-lucide="info"></i>
                            Trạng thái Cửa hàng
                        </h2>
                    </div>
                    <div class="admin-card-body">
                        <div class="mb-3">
                            <label class="admin-form-label">Trạng thái hiện tại</label>
                            <div>
                                @if (Model.IsStoreActive)
                                {
                                    <span class="admin-badge admin-badge-success">
                                        <i data-lucide="check-circle"></i>
                                        Đang hoạt động
                                    </span>
                                }
                                else
                                {
                                    <span class="admin-badge admin-badge-danger">
                                        <i data-lucide="x-circle"></i>
                                        Đã tắt
                                    </span>
                                }
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="admin-form-label">Cập nhật cuối</label>
                            <p class="text-muted mb-0">
                                @DateTime.Now.ToString("dd/MM/yyyy HH:mm")
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Help Section -->
                <div class="admin-card" style="margin-top: 1.5rem;">
                    <div class="admin-card-header">
                        <h2 class="admin-card-title">
                            <i data-lucide="help-circle"></i>
                            Trợ giúp
                        </h2>
                    </div>
                    <div class="admin-card-body">
                        <p class="text-muted mb-3">
                            Cần hỗ trợ về cài đặt cửa hàng?
                        </p>
                        <div style="display: grid; gap: 0.75rem;">
                            <button type="button" class="admin-btn admin-btn-outline" data-bs-toggle="modal" data-bs-target="#helpModal">
                                <i data-lucide="book-open"></i>
                                Hướng dẫn
                            </button>
                            <a href="mailto:support@johnhenry.vn" class="admin-btn admin-btn-outline">
                                <i data-lucide="mail"></i>
                                Liên hệ hỗ trợ
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<!-- Help Modal -->
<div class="modal fade" id="helpModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i data-lucide="help-circle"></i>
                    Hướng dẫn Cài đặt
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="accordion" id="helpAccordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#help1">
                                Cài đặt Kinh doanh
                            </button>
                        </h2>
                        <div id="help1" class="accordion-collapse collapse show" data-bs-parent="#helpAccordion">
                            <div class="accordion-body">
                                <p><strong>Trạng thái cửa hàng:</strong> Bật/tắt để khách hàng có thể xem sản phẩm của bạn.</p>
                                <p><strong>Giờ hoạt động:</strong> Thiết lập giờ mở cửa và đóng cửa để khách hàng biết khi nào liên hệ.</p>
                                <p><strong>Ngày nghỉ:</strong> Chọn những ngày trong tuần mà cửa hàng không hoạt động.</p>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#help2">
                                Thông báo
                            </button>
                        </h2>
                        <div id="help2" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                            <div class="accordion-body">
                                <p><strong>Email thông báo:</strong> Chọn loại thông báo bạn muốn nhận qua email.</p>
                                <p><strong>Báo cáo:</strong> Thiết lập tần suất nhận báo cáo doanh số.</p>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#help3">
                                Quản lý Kho
                            </button>
                        </h2>
                        <div id="help3" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                            <div class="accordion-body">
                                <p><strong>Ngưỡng cảnh báo:</strong> Đặt số lượng tối thiểu để nhận cảnh báo hết hàng.</p>
                                <p><strong>Ẩn hết hàng:</strong> Tự động ẩn sản phẩm khi hết hàng khỏi trang công khai.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Initialize Lucide icons
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }

        // Form handling
        function resetForm() {
            if (confirm('Bạn có chắc muốn khôi phục lại cài đặt ban đầu?')) {
                window.location.reload();
            }
        }

        // Real-time validation
        document.addEventListener('DOMContentLoaded', function() {
            // Store description character counter
            const descTextarea = document.querySelector('textarea[name="StoreDescription"]');
            if (descTextarea) {
                descTextarea.addEventListener('input', function() {
                    const current = this.value.length;
                    const max = 500;
                    const remaining = max - current;
                    
                    let counterEl = this.parentElement.querySelector('.char-counter');
                    if (!counterEl) {
                        counterEl = document.createElement('small');
                        counterEl.className = 'char-counter text-muted';
                        counterEl.style.display = 'block';
                        counterEl.style.marginTop = '0.25rem';
                        this.parentElement.appendChild(counterEl);
                    }
                    
                    counterEl.textContent = remaining + ' ký tự còn lại';
                    
                    if (remaining < 0) {
                        counterEl.classList.remove('text-muted');
                        counterEl.classList.add('text-danger');
                    } else {
                        counterEl.classList.remove('text-danger');
                        counterEl.classList.add('text-muted');
                    }
                });
            }

            // Business hours validation
            const startTime = document.querySelector('input[name="BusinessHoursStart"]');
            const endTime = document.querySelector('input[name="BusinessHoursEnd"]');
            
            if (startTime && endTime) {
                const validateHours = function() {
                    if (startTime.value && endTime.value && startTime.value >= endTime.value) {
                        alert('Giờ đóng cửa phải sau giờ mở cửa');
                        this.focus();
                    }
                };
                
                startTime.addEventListener('change', validateHours);
                endTime.addEventListener('change', validateHours);
            }
        });
    </script>
}
