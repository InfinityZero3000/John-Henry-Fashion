@model JohnHenryFashionWeb.ViewModels.ProductCreateEditViewModel
@{
    ViewData["Title"] = "Thêm sản phẩm mới";
    Layout = "~/Views/Shared/_SellerLayout.cshtml";
}

<div class="admin-content">
    <!-- Header -->
    <div class="admin-header" style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 1rem;">
        <div>
            <h1 class="admin-page-title">
                <i data-lucide="package-plus"></i>
                Thêm sản phẩm mới
            </h1>
            <p style="color: var(--admin-text-light); margin-top: 0.5rem;">
                <a href="@Url.Action("Dashboard", "Seller")" style="color: var(--admin-text-light); text-decoration: none;">Dashboard</a>
                <span style="margin: 0 0.5rem;">/</span>
                <a href="@Url.Action("Products", "Seller")" style="color: var(--admin-text-light); text-decoration: none;">Sản phẩm</a>
                <span style="margin: 0 0.5rem;">/</span>
                Thêm mới
            </p>
        </div>
        <a href="@Url.Action("Products", "Seller")" class="admin-btn admin-btn-secondary">
            <i data-lucide="arrow-left"></i>
            Quay lại
        </a>
    </div>

    <form asp-action="CreateProduct" method="post" enctype="multipart/form-data" id="productForm">
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: var(--spacing-lg);">
            <!-- Main Content -->
            <div>
                <!-- Basic Information -->
                <div class="admin-card" style="margin-bottom: var(--spacing-lg);">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">
                            <i data-lucide="info" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 0.5rem;"></i>
                            Thông tin cơ bản
                        </h3>
                    </div>
                    <div class="admin-card-body">
                        <div style="margin-bottom: 1.5rem;">
                            <label asp-for="Name" class="admin-form-label">Tên sản phẩm <span style="color: var(--admin-danger);">*</span></label>
                            <input asp-for="Name" class="admin-form-input" placeholder="Nhập tên sản phẩm...">
                            <span asp-validation-for="Name" style="color: var(--admin-danger); font-size: 0.875rem;"></span>
                        </div>

                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                            <div>
                                <label asp-for="SKU" class="admin-form-label">SKU <span style="color: var(--admin-danger);">*</span></label>
                                <input asp-for="SKU" class="admin-form-input" placeholder="Mã sản phẩm...">
                                <span asp-validation-for="SKU" style="color: var(--admin-danger); font-size: 0.875rem;"></span>
                            </div>
                            <div>
                                <label asp-for="Status" class="admin-form-label">Trạng thái</label>
                                <select asp-for="Status" class="admin-form-select">
                                    <option value="active">Đang bán</option>
                                    <option value="inactive">Tạm dừng</option>
                                    <option value="out_of_stock">Hết hàng</option>
                                </select>
                            </div>
                        </div>

                        <div style="margin-bottom: 1.5rem;">
                            <label asp-for="ShortDescription" class="admin-form-label">Mô tả ngắn</label>
                            <textarea asp-for="ShortDescription" class="admin-form-input" rows="3" placeholder="Mô tả ngắn gọn về sản phẩm..."></textarea>
                            <span asp-validation-for="ShortDescription" style="color: var(--admin-danger); font-size: 0.875rem;"></span>
                        </div>

                        <div style="margin-bottom: 0;">
                            <label asp-for="Description" class="admin-form-label">Mô tả chi tiết</label>
                            <textarea asp-for="Description" class="admin-form-input" rows="8" id="descriptionEditor"></textarea>
                            <span asp-validation-for="Description" style="color: var(--admin-danger); font-size: 0.875rem;"></span>
                        </div>
                    </div>
                </div>

                <!-- Pricing -->
                <div class="admin-card" style="margin-bottom: var(--spacing-lg);">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">
                            <i data-lucide="dollar-sign" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 0.5rem;"></i>
                            Giá bán
                        </h3>
                    </div>
                    <div class="admin-card-body">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                            <div>
                                <label asp-for="Price" class="admin-form-label">Giá gốc <span style="color: var(--admin-danger);">*</span></label>
                                <div style="display: flex;">
                                    <input asp-for="Price" class="admin-form-input" type="number" step="1000" min="0" style="border-top-right-radius: 0; border-bottom-right-radius: 0;">
                                    <span style="display: flex; align-items: center; padding: 0 1rem; background: var(--admin-bg-secondary); border: 1px solid var(--admin-border); border-left: none; border-top-right-radius: 8px; border-bottom-right-radius: 8px;">VNĐ</span>
                                </div>
                                <span asp-validation-for="Price" style="color: var(--admin-danger); font-size: 0.875rem;"></span>
                            </div>
                            <div>
                                <label asp-for="SalePrice" class="admin-form-label">Giá khuyến mãi</label>
                                <div style="display: flex;">
                                    <input asp-for="SalePrice" class="admin-form-input" type="number" step="1000" min="0" style="border-top-right-radius: 0; border-bottom-right-radius: 0;">
                                    <span style="display: flex; align-items: center; padding: 0 1rem; background: var(--admin-bg-secondary); border: 1px solid var(--admin-border); border-left: none; border-top-right-radius: 8px; border-bottom-right-radius: 8px;">VNĐ</span>
                                </div>
                                <small style="color: var(--admin-text-muted); font-size: 0.875rem;">Để trống nếu không có khuyến mãi</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Product Attributes -->
                <div class="admin-card" style="margin-bottom: var(--spacing-lg);">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">
                            <i data-lucide="tag" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 0.5rem;"></i>
                            Thuộc tính sản phẩm
                        </h3>
                    </div>
                    <div class="admin-card-body">
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                            <div>
                                <label asp-for="Size" class="admin-form-label">Kích thước</label>
                                <input asp-for="Size" class="admin-form-input" placeholder="S, M, L, XL...">
                            </div>
                            <div>
                                <label asp-for="Color" class="admin-form-label">Màu sắc</label>
                                <input asp-for="Color" class="admin-form-input" placeholder="Đen, Trắng, Xanh...">
                            </div>
                            <div>
                                <label asp-for="Material" class="admin-form-label">Chất liệu</label>
                                <input asp-for="Material" class="admin-form-input" placeholder="Cotton, Polyester...">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                            <div>
                                <label asp-for="Weight" class="admin-form-label">Trọng lượng</label>
                                <div style="display: flex;">
                                    <input asp-for="Weight" class="admin-form-input" type="number" step="0.1" min="0" style="border-top-right-radius: 0; border-bottom-right-radius: 0;">
                                    <span style="display: flex; align-items: center; padding: 0 1rem; background: var(--admin-bg-secondary); border: 1px solid var(--admin-border); border-left: none; border-top-right-radius: 8px; border-bottom-right-radius: 8px;">kg</span>
                                </div>
                            </div>
                            <div>
                                <label asp-for="Dimensions" class="admin-form-label">Kích thước (DxRxC)</label>
                                <input asp-for="Dimensions" class="admin-form-input" placeholder="30x40x5 cm">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SEO -->
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">
                            <i data-lucide="search" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 0.5rem;"></i>
                            SEO & Marketing
                        </h3>
                    </div>
                    <div class="admin-card-body">
                        <div style="margin-bottom: 1.5rem;">
                            <label asp-for="MetaTitle" class="admin-form-label">Meta Title</label>
                            <input asp-for="MetaTitle" class="admin-form-input" placeholder="Tiêu đề SEO...">
                            <small style="color: var(--admin-text-muted); font-size: 0.875rem;">Để trống để sử dụng tên sản phẩm</small>
                        </div>

                        <div style="margin-bottom: 1.5rem;">
                            <label asp-for="MetaDescription" class="admin-form-label">Meta Description</label>
                            <textarea asp-for="MetaDescription" class="admin-form-input" rows="2" placeholder="Mô tả cho search engine..."></textarea>
                        </div>

                        <div style="margin-bottom: 0;">
                            <label asp-for="Tags" class="admin-form-label">Tags</label>
                            <input asp-for="Tags" class="admin-form-input" placeholder="tag1, tag2, tag3...">
                            <small style="color: var(--admin-text-muted); font-size: 0.875rem;">Các từ khóa phân cách bằng dấu phẩy</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div>
                <!-- Category & Brand -->
                <div class="admin-card" style="margin-bottom: var(--spacing-lg);">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">
                            <i data-lucide="folder" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 0.5rem;"></i>
                            Phân loại
                        </h3>
                    </div>
                    <div class="admin-card-body">
                        <div style="margin-bottom: 1.5rem;">
                            <label asp-for="CategoryId" class="admin-form-label">Danh mục <span style="color: var(--admin-danger);">*</span></label>
                            <select asp-for="CategoryId" class="admin-form-select" asp-items="@ViewBag.Categories">
                                <option value="">-- Chọn danh mục --</option>
                            </select>
                            <span asp-validation-for="CategoryId" style="color: var(--admin-danger); font-size: 0.875rem;"></span>
                        </div>

                        <div style="margin-bottom: 0;">
                            <label asp-for="BrandId" class="admin-form-label">Thương hiệu</label>
                            <select asp-for="BrandId" class="admin-form-select" asp-items="@ViewBag.Brands">
                                <option value="">-- Chọn thương hiệu --</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Inventory -->
                <div class="admin-card" style="margin-bottom: var(--spacing-lg);">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">
                            <i data-lucide="package" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 0.5rem;"></i>
                            Tồn kho
                        </h3>
                    </div>
                    <div class="admin-card-body">
                        <div style="margin-bottom: 1.5rem;">
                            <label asp-for="StockQuantity" class="admin-form-label">Số lượng tồn kho <span style="color: var(--admin-danger);">*</span></label>
                            <input asp-for="StockQuantity" class="admin-form-input" type="number" min="0">
                            <span asp-validation-for="StockQuantity" style="color: var(--admin-danger); font-size: 0.875rem;"></span>
                        </div>

                        <div class="admin-form-check" style="margin-bottom: 1.5rem;">
                            <input asp-for="ManageStock" class="admin-form-check-input" type="checkbox" checked>
                            <label asp-for="ManageStock" class="admin-form-check-label">
                                Quản lý tồn kho
                            </label>
                            <small style="color: var(--admin-text-muted); font-size: 0.875rem; display: block; margin-top: 0.25rem;">Tự động cập nhật khi có đơn hàng</small>
                        </div>

                        <div class="admin-form-check" style="margin-bottom: 0;">
                            <input asp-for="InStock" class="admin-form-check-input" type="checkbox" checked>
                            <label asp-for="InStock" class="admin-form-check-label">
                                Còn hàng
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Featured Image -->
                <div class="admin-card" style="margin-bottom: var(--spacing-lg);">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">
                            <i data-lucide="image" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 0.5rem;"></i>
                            Hình ảnh chính
                        </h3>
                    </div>
                    <div class="admin-card-body">
                        <div style="margin-bottom: 1rem;">
                            <label class="admin-form-label">Chọn ảnh chính</label>
                            <input type="file" name="FeaturedImage" class="admin-form-input" accept="image/*" id="featuredImageInput">
                            <small style="color: var(--admin-text-muted); font-size: 0.875rem;">Kích thước khuyến nghị: 800x800px</small>
                        </div>

                        <div id="imagePreview" style="display: none; margin-top: 1rem;">
                            <img id="previewImg" src="" style="max-height: 200px; width: 100%; object-fit: cover; border-radius: 8px; border: 2px solid var(--admin-border);">
                            <button type="button" class="admin-btn admin-btn-sm admin-btn-danger" onclick="removeImage()" style="margin-top: 0.5rem; width: 100%;">
                                <i data-lucide="trash-2"></i>
                                Xóa ảnh
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Settings -->
                <div class="admin-card" style="margin-bottom: var(--spacing-lg);">
                    <div class="admin-card-header">
                        <h3 class="admin-card-title">
                            <i data-lucide="settings" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 0.5rem;"></i>
                            Cài đặt
                        </h3>
                    </div>
                    <div class="admin-card-body">
                        <div class="admin-form-check" style="margin-bottom: 1.5rem;">
                            <input asp-for="IsFeatured" class="admin-form-check-input" type="checkbox">
                            <label asp-for="IsFeatured" class="admin-form-check-label">
                                Sản phẩm nổi bật
                            </label>
                            <small style="color: var(--admin-text-muted); font-size: 0.875rem; display: block; margin-top: 0.25rem;">Hiển thị ở vị trí ưu tiên</small>
                        </div>

                        <div class="admin-form-check" style="margin-bottom: 0;">
                            <input asp-for="IsActive" class="admin-form-check-input" type="checkbox" checked>
                            <label asp-for="IsActive" class="admin-form-check-label">
                                Kích hoạt
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="admin-card">
                    <div class="admin-card-body">
                        <div style="display: grid; gap: 0.75rem;">
                            <button type="submit" class="admin-btn admin-btn-success" style="width: 100%;">
                                <i data-lucide="save"></i>
                                Lưu sản phẩm
                            </button>
                            <button type="button" class="admin-btn admin-btn-secondary" onclick="previewProduct()" style="width: 100%;">
                                <i data-lucide="eye"></i>
                                Xem trước
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <!-- TinyMCE -->
    <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
    
    <script>
        // Initialize Lucide icons
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
        });

        // Initialize TinyMCE
        tinymce.init({
            selector: '#descriptionEditor',
            height: 300,
            menubar: false,
            plugins: [
                'advlist', 'autolink', 'lists', 'link', 'image', 'charmap',
                'anchor', 'searchreplace', 'visualblocks', 'code',
                'insertdatetime', 'media', 'table', 'help', 'wordcount'
            ],
            toolbar: 'undo redo | blocks | bold italic forecolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help',
            content_style: 'body { font-family: -apple-system, BlinkMacSystemFont, San Francisco, Segoe UI, Roboto, Helvetica Neue, sans-serif; font-size: 14px; }'
        });

        // Image preview
        document.getElementById('featuredImageInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('imagePreview').style.display = 'block';
                    // Re-initialize Lucide icons after showing preview
                    setTimeout(() => lucide.createIcons(), 100);
                };
                reader.readAsDataURL(file);
            }
        });

        function removeImage() {
            document.getElementById('featuredImageInput').value = '';
            document.getElementById('imagePreview').style.display = 'none';
        }

        function previewProduct() {
            showToast('info', 'Tính năng xem trước sẽ được cập nhật sau');
        }

        // Form validation
        document.getElementById('productForm').addEventListener('submit', function(e) {
            const name = document.querySelector('[name="Name"]').value.trim();
            const sku = document.querySelector('[name="SKU"]').value.trim();
            const price = document.querySelector('[name="Price"]').value;

            if (!name) {
                showToast('error', 'Vui lòng nhập tên sản phẩm.');
                e.preventDefault();
                return;
            }

            if (!sku) {
                showToast('error', 'Vui lòng nhập SKU.');
                e.preventDefault();
                return;
            }

            if (!price || price <= 0) {
                showToast('error', 'Vui lòng nhập giá sản phẩm hợp lệ.');
                e.preventDefault();
                return;
            }
        });

        // Toast notification helper
        function showToast(type, message) {
            const toast = document.createElement('div');
            const alertType = type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info';
            toast.className = `alert alert-${alertType} alert-dismissible fade show position-fixed`;
            toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            toast.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
    </script>
}

